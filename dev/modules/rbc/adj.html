<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>mesh adjacency structure</title>
<link rel="stylesheet" href="/udoc/css/main.css">
<link rel="stylesheet" href="./pygments-colorful.css">
</head>
<body class="article">
<div id="header">
<h1>mesh adjacency structure</h1>
</div>
<div id="content">
<div class="paragraph">
<p>Consider closed triangulated mesh with <code>nv</code> vertices. Degree of a
vertex is the number of edges incident to the vertex. Let <code>md</code> is a
maximum degree of the vertices. There are three types of forces: edge
forces which depend on two vertices, triangle forces which depend on
three vertices, and dihedral forces which depend of four vertices
(edge and two adjusting triangles). To compute forces in one membrane
<em>uDeviceX</em> launches <code>nv * md</code> threads, each thread adds forces to only
one vertices.  <code>Adj_v</code> has an API call which allows for a given thread
ID to find which vertices should be used in forces computation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">Unresolved</span> <span class="tok-n">directive</span> <span class="tok-n">in</span> <span class="tok-n">adj</span><span class="tok-p">.</span><span class="tok-n">adoc</span> <span class="tok-o">-</span> <span class="tok-n">include</span><span class="tok-o">::</span><span class="tok-p">..</span><span class="tok-o">/</span><span class="tok-p">..</span><span class="tok-o">/</span><span class="tok-p">..</span><span class="tok-o">/</span><span class="tok-n">src</span><span class="tok-o">/</span><span class="tok-n">rbc</span><span class="tok-o">/</span><span class="tok-n">adj</span><span class="tok-o">/</span><span class="tok-n">dev</span><span class="tok-p">.</span><span class="tok-n">h</span><span class="tok-p">[</span><span class="tok-n">tag</span><span class="tok-o">=</span><span class="tok-n">interface</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>md * nv</code> is bigger than the number of edges in the membrane and
some threads are not needed. The function returns 0 in this case.
<code>AdjMap</code> is a structure which contains five indices and an ID of the
mesh:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">Unresolved</span> <span class="tok-n">directive</span> <span class="tok-n">in</span> <span class="tok-n">adj</span><span class="tok-p">.</span><span class="tok-n">adoc</span> <span class="tok-o">-</span> <span class="tok-n">include</span><span class="tok-o">::</span><span class="tok-p">..</span><span class="tok-o">/</span><span class="tok-p">..</span><span class="tok-o">/</span><span class="tok-p">..</span><span class="tok-o">/</span><span class="tok-n">src</span><span class="tok-o">/</span><span class="tok-n">rbc</span><span class="tok-o">/</span><span class="tok-n">adj</span><span class="tok-o">/</span><span class="tok-n">type</span><span class="tok-o">/</span><span class="tok-n">common</span><span class="tok-p">.</span><span class="tok-n">h</span><span class="tok-p">[</span><span class="tok-n">tag</span><span class="tok-o">=</span><span class="tok-n">interface</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each thread adds force to a vertices with index <code>0</code>. It considers edge
<code>01</code>, triangle <code>012</code>, and two dihedrals <code>0124</code> and <code>1203</code>. For
example, a contribution of edge force <code>01</code> to vertex <code>1</code> is added by
another thread.</p>
</div>
<div class="paragraph">
<p><code>Adj_v</code> is initilized from a host structure <code>Adj</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">Unresolved</span> <span class="tok-n">directive</span> <span class="tok-n">in</span> <span class="tok-n">adj</span><span class="tok-p">.</span><span class="tok-n">adoc</span> <span class="tok-o">-</span> <span class="tok-n">include</span><span class="tok-o">::</span><span class="tok-p">..</span><span class="tok-o">/</span><span class="tok-p">..</span><span class="tok-o">/</span><span class="tok-p">..</span><span class="tok-o">/</span><span class="tok-n">src</span><span class="tok-o">/</span><span class="tok-n">rbc</span><span class="tok-o">/</span><span class="tok-n">adj</span><span class="tok-o">/</span><span class="tok-n">imp</span><span class="tok-p">.</span><span class="tok-n">h</span><span class="tok-p">[</span><span class="tok-n">tag</span><span class="tok-o">=</span><span class="tok-n">interface</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Adj</code> can be used to pack data which can be asseced on device:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">float</span> <span class="tok-o">*</span><span class="tok-n">A</span><span class="tok-p">;</span>
<span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">adj_get_max</span><span class="tok-p">(</span><span class="tok-n">adj</span><span class="tok-p">);</span>
<span class="tok-n">EMALLOC</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">A</span><span class="tok-p">);</span>
<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
   <span class="tok-n">valid</span> <span class="tok-o">=</span> <span class="tok-n">adj_get_map</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">adj</span><span class="tok-p">,</span> <span class="tok-cm">/**/</span> <span class="tok-o">&amp;</span><span class="tok-n">m</span><span class="tok-p">);</span>
   <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">valid</span><span class="tok-p">)</span> <span class="tok-k">continue</span><span class="tok-p">;</span>
   <span class="tok-n">i0</span> <span class="tok-o">=</span> <span class="tok-n">m</span><span class="tok-p">.</span><span class="tok-n">i0</span><span class="tok-p">;</span> <span class="tok-n">i1</span> <span class="tok-o">=</span> <span class="tok-n">m</span><span class="tok-p">.</span><span class="tok-n">i1</span><span class="tok-p">;</span> <span class="tok-n">i2</span> <span class="tok-o">=</span> <span class="tok-n">m</span><span class="tok-p">.</span><span class="tok-n">i2</span><span class="tok-p">;</span>
   <span class="tok-n">A</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">some_function_of</span><span class="tok-p">(</span><span class="tok-n">i0</span><span class="tok-p">,</span> <span class="tok-n">i1</span><span class="tok-p">,</span> <span class="tok-n">i2</span><span class="tok-p">)</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</body>
</html>