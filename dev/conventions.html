<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>coding conventions</title>
<link rel="stylesheet" href="/udoc/css/main.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./pygments-default.css">
</head>
<body class="article">
<div id="header">
<h1>coding conventions</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_modules">1. modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>uDeviceX</em> consists of modules.
Modules are as independant as possible.
They consist of a folder with one or more compilation units, and an
interface.
Whenever it is possible, the structures are hidden from the client of
the module.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_naming">2. naming</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_variables">2.1. variables</h3>
<div class="ulist">
<ul>
<li>
<p>names of local variables are short and understandable from the context</p>
</li>
<li>
<p>names of global variables are as descriptive as possible</p>
</li>
<li>
<p>arrays of simple structures <code>x</code> have names <code>xx</code>, eg. <code>pp</code> is an
array of particles, <code>cc</code> is an array of colors, <code>ii</code> is an array of
indices * array of small dimentionality may use an enum type for
readability, e.g.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">enum</span> <span class="tok-p">{</span><span class="tok-n">X</span><span class="tok-p">,</span> <span class="tok-n">Y</span><span class="tok-p">,</span> <span class="tok-n">Z</span><span class="tok-p">};</span>
<span class="tok-kt">int</span> <span class="tok-n">r</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">];</span>
<span class="tok-n">r</span><span class="tok-p">[</span><span class="tok-n">X</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">rx</span><span class="tok-p">;</span>
<span class="tok-n">r</span><span class="tok-p">[</span><span class="tok-n">Y</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">ry</span><span class="tok-p">;</span>
<span class="tok-n">r</span><span class="tok-p">[</span><span class="tok-n">Z</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">rz</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_functions">2.2. functions</h3>
<div class="ulist">
<ul>
<li>
<p>a function name is descriptive on its own or inside a module.</p>
</li>
<li>
<p>arguments are ordered as follow:</p>
<div class="ulist">
<ul>
<li>
<p>input is at the beginning</p>
</li>
<li>
<p>input/output come after input and start with a commented <code>io</code></p>
</li>
<li>
<p>output comes after input/output and start with a comment or <code>o</code> depending on the context</p>
</li>
<li>
<p>sizes have higher priority than arrays</p>
</li>
<li>
<p>workspace comes at the end ans starts with a commented <code>w</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>do <strong>not</strong> use references, use pointers instead</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of valid function declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-nf">read_int_from_file</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">fname</span><span class="tok-p">,</span> <span class="tok-cm">/**/</span> <span class="tok-kt">int</span> <span class="tok-o">*</span><span class="tok-n">n</span><span class="tok-p">,</span> <span class="tok-kt">int</span> <span class="tok-o">*</span><span class="tok-n">ii</span><span class="tok-p">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">forward_euler</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">Force</span> <span class="tok-o">*</span><span class="tok-n">ff</span><span class="tok-p">,</span> <span class="tok-cm">/* io */</span> <span class="tok-n">Particle</span> <span class="tok-o">*</span><span class="tok-n">pp</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function names part of a module interface start with the module name.
Functions private to a module do not need to contain the module name
if the context make it clear. Use the <code>static</code> qualifier for functions
with compilation-unit scope.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_file_structure">3. file structure</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>no include guards; no "headers in headers" if easily avoidable</p>
</li>
<li>
<p>all cuda kernels are in a separate header <code>.h</code> file</p>
</li>
<li>
<p>a module is implemented inside its own directory <code>A</code></p>
<div class="ulist">
<ul>
<li>
<p>it has its own object <code>A/imp.cu</code> or <code>A/imp.cpp</code> (<code>.cpp</code> prefered if possible)</p>
</li>
<li>
<p>interface <code>A/imp.h</code></p>
</li>
<li>
<p>implementation can be done in separate files inside <code>A/imp/</code> directory</p>
</li>
<li>
<p>internal cuda (private to module) code are inside <code>A/dev/</code> directory</p>
</li>
<li>
<p>cuda interface inside <code>A/dev.h</code> (for client use)</p>
</li>
</ul>
</div>
</li>
<li>
<p>modules can have submodules, which follow the same structure as above, e.g. submodule <code>B</code> inside module <code>A</code> belongs to <code>A/B/</code> directory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_style">4. style</h2>
<div class="sectionbody">
<div class="paragraph">
<p>for emacs: the following c++ mode is used</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="lisp"><span></span><span class="tok-p">(</span><span class="tok-nb">defun</span> <span class="tok-nv">u/c-indent-common</span> <span class="tok-p">()</span>
  <span class="tok-p">(</span><span class="tok-k">setq</span> <span class="tok-nv">c-basic-offset</span> <span class="tok-mi">4</span>
	<span class="tok-nv">indent-tabs-mode</span> <span class="tok-no">nil</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-nb">defun</span> <span class="tok-nv">u/c++-indent</span> <span class="tok-p">()</span>
  <span class="tok-p">(</span><span class="tok-nv">u/c-indent-common</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nv">c-set-offset</span> <span class="tok-ss">&#39;innamespace</span> <span class="tok-nv">[0]</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-nb">defun</span> <span class="tok-nv">u/c-indent</span> <span class="tok-p">()</span> <span class="tok-p">(</span><span class="tok-nv">u/c-indent-common</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-nv">add-hook</span> <span class="tok-ss">&#39;c-mode-hook</span>   <span class="tok-ss">&#39;u/c-indent</span><span class="tok-p">)</span>
<span class="tok-p">(</span><span class="tok-nv">add-hook</span> <span class="tok-ss">&#39;c++-mode-hook</span> <span class="tok-ss">&#39;u/c++-indent</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">setq</span> <span class="tok-nv">c-default-style</span>
      <span class="tok-o">&#39;</span><span class="tok-p">((</span><span class="tok-nv">java-mode</span> <span class="tok-o">.</span> <span class="tok-s">&quot;java&quot;</span><span class="tok-p">)</span>
        <span class="tok-p">(</span><span class="tok-nv">awk-mode</span>  <span class="tok-o">.</span> <span class="tok-s">&quot;awk&quot;</span><span class="tok-p">)</span>
        <span class="tok-p">(</span><span class="tok-nv">c-mode</span>    <span class="tok-o">.</span> <span class="tok-s">&quot;k&amp;r&quot;</span><span class="tok-p">)</span>
        <span class="tok-p">(</span><span class="tok-nv">cc-mode</span>   <span class="tok-o">.</span> <span class="tok-s">&quot;k&amp;r&quot;</span><span class="tok-p">)))</span>

<span class="tok-p">(</span><span class="tok-nv">add-to-list</span> <span class="tok-ss">&#39;auto-mode-alist</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s">&quot;\\.cu\\&#39;&quot;</span> <span class="tok-o">.</span> <span class="tok-nv">c++-mode</span><span class="tok-p">))</span>
<span class="tok-p">(</span><span class="tok-nv">add-to-list</span> <span class="tok-ss">&#39;auto-mode-alist</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s">&quot;\\.h\\&#39;&quot;</span>  <span class="tok-o">.</span> <span class="tok-nv">c++-mode</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>